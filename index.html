<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crash Platform</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --p: #7b42f5; --bg: #0a0a0b; --txt: #fff; --card: #16161e; }
        .light-mode { --bg: #f4f4f9; --txt: #000; --card: #fff; }
        body { background: var(--bg); color: var(--txt); font-family: 'Segoe UI', sans-serif; margin: 0; transition: 0.3s; overflow-x: hidden; }
        
        /* Ro'yxatdan o'tish */
        #auth-screen, #main-app { display: none; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .input-group { margin-bottom: 15px; text-align: left; }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #333; background: var(--card); color: var(--txt); outline: none; box-sizing: border-box; }
        
        /* Navigatsiya */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 100; }
        .nav-item { font-size: 10px; cursor: pointer; text-align: center; opacity: 0.6; }
        .nav-item.active { opacity: 1; color: var(--p); }

        /* O'yin */
        .game-area { text-align: center; }
        #multiplier { font-size: 50px; font-weight: 800; margin: 20px 0; }
        canvas { width: 100%; height: 180px; background: #000; border-radius: 15px; }

        /* Tugmalar */
        .btn { border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; }
        .btn-p { background: var(--p); color: #fff; }
        
        /* Panellar */
        .panel { display: none; padding-bottom: 80px; }
        .active-panel { display: block; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
    </style>
</head>
<body>

<div id="auth-screen">
    <h2 style="color: var(--p);">Ro'yxatdan o'tish</h2>
    <div class="input-group"><input type="text" id="reg-name" placeholder="Ism"></div>
    <div class="input-group"><input type="text" id="reg-surname" placeholder="Familiya"></div>
    <div class="input-group">
        <select id="reg-region">
            <option value="">Viloyatni tanlang</option>
            <option value="Toshkent">Toshkent</option>
            <option value="Samarqand">Samarqand</option>
            <option value="Buxoro">Buxoro</option>
            <option value="Andijon">Andijon</option>
        </select>
    </div>
    <div class="input-group">
        <select id="reg-currency">
            <option value="UZS">O'zbek so'mi (UZS)</option>
            <option value="USD">Dollar (USD)</option>
        </select>
    </div>
    <button class="btn btn-p" onclick="register()">BARMOQ IZI BILAN TASDIQLASH</button>
</div>

<div id="main-app">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <b id="user-display">Maruf</b>
        <div style="background: var(--p); padding: 5px 15px; border-radius: 20px;">
            <span id="main-balance">0</span> <span class="cur-unit">UZS</span>
        </div>
    </div>

    <div id="panel-games" class="panel active-panel">
        <div class="game-area">
            <canvas id="graph"></canvas>
            <div id="multiplier">1.00x</div>
            <div class="input-group">
                <input type="number" id="bet-amount" placeholder="Tikish miqdori">
            </div>
            <button id="betBtn" class="btn btn-p" onclick="handleBet()">TIKISH</button>
        </div>
    </div>

    <div id="panel-deposit" class="panel">
        <h3>Hisobni to'ldirish</h3>
        <div class="card">
            <p>Karta: <b>4073 4200 6816 5541</b></p>
            <p>To'lov tizimi: Alif, Xazna, Payme, Click</p>
            <input type="number" id="dep-amount" placeholder="Summa">
            <button class="btn btn-p" style="margin-top: 10px;" onclick="alert('To\'lov qabul qilindi (Simulyatsiya)')">TO'LADIM</button>
        </div>
    </div>

    <div id="panel-withdraw" class="panel">
        <h3>Pul chiqarish</h3>
        <div class="card">
            <input type="number" id="wit-amount" placeholder="Chiqarish summasi">
            <button class="btn btn-p" style="margin-top: 10px;" onclick="alert('So\'rov yuborildi (Simulyatsiya)')">YECHIB OLISH</button>
        </div>
    </div>

    <div id="panel-settings" class="panel">
        <h3>Sozlamalar</h3>
        <div class="card" onclick="toggleTheme()">Rejimni o'zgartirish (Tun/Kun)</div>
        <div class="card" style="color: red;" onclick="location.reload()">Tizimdan chiqish</div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showPanel('games', this)">üéÆ<br>O'yinlar</div>
        <div class="nav-item" onclick="showPanel('deposit', this)">üí≥<br>To'ldirish</div>
        <div class="nav-item" onclick="showPanel('withdraw', this)">üì§<br>Chiqarish</div>
        <div class="nav-item" onclick="showPanel('settings', this)">‚öôÔ∏è<br>Sozlamalar</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
        authDomain: "gen-lang-client-0228947349.firebaseapp.com",
        databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
        projectId: "gen-lang-client-0228947349"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Ro'yxatdan o'tish (Barmoq izi simulyatsiyasi bilan)
    window.register = async () => {
        const name = document.getElementById('reg-name').value;
        const cur = document.getElementById('reg-currency').value;
        if(!name || !document.getElementById('reg-region').value) return alert("Ma'lumotlarni to'ldiring");

        // Barmoq izi (WebAuthn API simulyatsiyasi)
        if (window.PublicKeyCredential) {
            alert("Barmoq izi skanerdan o'tkazilmoqda...");
            const userData = {
                name: name,
                surname: document.getElementById('reg-surname').value,
                region: document.getElementById('reg-region').value,
                currency: cur,
                balance: cur === "UZS" ? 100000 : 10
            };
            const userId = tg.initDataUnsafe?.user?.id || "local_user";
            await set(ref(db, 'users/' + userId), userData);
            startApp(userData);
        }
    };

    function startApp(data) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('user-display').innerText = data.name;
        document.getElementById('main-balance').innerText = data.balance;
        document.querySelectorAll('.cur-unit').forEach(el => el.innerText = data.currency);
    }

    // Navigatsiya
    window.showPanel = (name, el) => {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active-panel'));
        document.getElementById('panel-' + name).classList.add('active-panel');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    };

    // Tun/Kun rejimi
    window.toggleTheme = () => {
        document.body.classList.toggle('light-mode');
    };

    // Avtomatik tekshirish
    window.onload = async () => {
        const userId = tg.initDataUnsafe?.user?.id || "local_user";
        const snapshot = await get(ref(db, 'users/' + userId));
        if(snapshot.exists()) startApp(snapshot.val());
        else document.getElementById('auth-screen').style.display = 'block';
    };

    // CRASH O'YINI MANTIG'I (Qisqa)
    let isRunning = false;
    window.handleBet = () => {
        const bet = parseFloat(document.getElementById('bet-amount').value);
        const cur = document.querySelectorAll('.cur-unit')[0].innerText;
        
        // Limitlar
        if(cur === "UZS" && (bet < 3000 || bet > 35000000)) return alert("Limit: 3,000 - 35,000,000 UZS");
        
        if(!isRunning) {
            isRunning = true;
            document.getElementById('betBtn').innerText = "CASH OUT";
            // O'yin sikli bu yerda boshlanadi...
        }
    };
</script>
</body>
</html>
